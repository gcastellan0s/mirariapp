{% extends "metronic/layout-5.html" %} 
{% load static %}
{% load i18n %}
{% load mirari_tags %}

{% block title %}{%if verbose_name_plural%}{{verbose_name_plural|upper}}{%else%}{{ model|verbose_name_plural|upper }}{%endif%} :: {{ G.ORGANIZATION.TITLE }}{% endblock title %}

{%block styles%}
    <link href="{%static 'metronic/dist/demo5/assets/vendors/custom/datatables/datatables.bundle.css'%}" rel="stylesheet" type="text/css" />
    {{block.super}}
{%endblock styles%}

<style>
    {%block css%}
        {{block.super}}
        div.dataTables_wrapper div.dataTables_paginate ul.pagination {
            justify-content: flex-start;
        }
        div.dataTables_wrapper div.dataTables_filter {
            text-align: left;
        }
        .dataTable td {
            color: #464648!important;
        }
    {%endblock css%}
</style>

div.dataTables_wrapper div.dataTables_paginate ul.pagination {
    margin: 2px 0;
    white-space: nowrap;
    -webkit-box-pack: end;
    -ms-flex-pack: end;
    justify-content: flex-start;
}

{%block subheader%}
    <div class="kt-subheader__main">
        <h3 class="kt-subheader__title kt-subheader__title--separator">
            <small>LISTA DE</small> 
			<strong>{%if verbose_name_plural%}{{verbose_name_plural|upper}}{%else%}{{ model|verbose_name_plural|upper }}{%endif%}</strong> 
        </h3>
        <span class="kt-subheader__separator kt-hidden"></span>
        <div class="kt-subheader__breadcrumbs">
            <span class="kt-subheader__breadcrumbs-separator"></span>
            <a href="/" class="kt-subheader__breadcrumbs-link">
                INICIO 
            </a>
        </div>
    </div>
{%endblock subheader%}

{%block content%}
    <!-- begin:: Content -->
    <div class="kt-portlet kt-portlet--mobile">
        <div class="kt-portlet__body py-0">
            <!--begin: Search Form -->
            <div class="kt-form kt-form--label-right kt-margin-t-20 kt-margin-b-10">
                <div class="row align-items-center">
                    <div class="col-xl-8 order-2 order-xl-1">
                        <div class="row align-items-center">
                            <div class="col-md-3 kt-margin-b-20-tablet-and-mobile">
                                <div class="kt-input-icon kt-input-icon--left">
                                    <input type="text" class="form-control" placeholder="BUSCAR..." id="generalSearch">
                                    <span class="kt-input-icon__icon kt-input-icon__icon--left">
                                        <span><i class="la la-search"></i></span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-9 kt-margin-b-20-tablet-and-mobile">
                                <div class="row align-items-center">
                                    {% for item in filters %}
                                        <div class="col-md-{{item.size}} kt-margin-b-20-tablet-and-mobile">
                                            <div class="kt-form__group kt-form__group--inline">
                                                <div class="kt-form__label">
                                                    <label></label>
                                                </div>
                                                <div class="kt-form__control">
                                                    <select class="form-control bootstrap-select" id="m_form_{{item.key}}">
                                                        <option value="">
                                                            {{item.label}}
                                                        </option>
                                                        {%for obj in item.options%}
                                                            <option value="{{obj.0}}">
                                                                {{obj.1}}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 order-1 order-xl-2 kt-align-right">
                        <div class="dropdown dropdown-inline">
                            <button type="button" class="btn btn-default btn-icon-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="la la-download"></i> Export
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <ul class="kt-nav">
                                    <li class="kt-nav__section kt-nav__section--first">
                                        <span class="kt-nav__section-text">Choose an option</span>
                                    </li>
                                    <li class="kt-nav__item">
                                        <a href="#" class="kt-nav__link">
                                            <i class="kt-nav__link-icon la la-print"></i>
                                            <span class="kt-nav__link-text">Print</span>
                                        </a>
                                    </li>
                                    <li class="kt-nav__item">
                                        <a href="#" class="kt-nav__link">
                                            <i class="kt-nav__link-icon la la-copy"></i>
                                            <span class="kt-nav__link-text">Copy</span>
                                        </a>
                                    </li>
                                    <li class="kt-nav__item">
                                        <a href="#" class="kt-nav__link">
                                            <i class="kt-nav__link-icon la la-file-excel-o"></i>
                                            <span class="kt-nav__link-text">Excel</span>
                                        </a>
                                    </li>
                                    <li class="kt-nav__item">
                                        <a href="#" class="kt-nav__link">
                                            <i class="kt-nav__link-icon la la-file-text-o"></i>
                                            <span class="kt-nav__link-text">CSV</span>
                                        </a>
                                    </li>
                                    <li class="kt-nav__item">
                                        <a href="#" class="kt-nav__link">
                                            <i class="kt-nav__link-icon la la-file-pdf-o"></i>
                                            <span class="kt-nav__link-text">PDF</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        &nbsp;
                        {%if model.url_add%}
                            {%if 'Can_Create__'|prepend_perm:model.VARS|if_has_perm:request and not 'create' in model.VARS.EXCLUDE_PERMISSIONS%}
                                <a href="{{model.url_add}}" class="btn btn-brand btn-elevate btn-icon-sm">
                                    <i class="la la-plus"></i>
                                    {{ model.add_text.0 }}
                                </a>
                            {%endif%}
                        {%endif%}
                    </div>
                </div>
            </div>
            <!--end: Search Form -->
        </div>
        <div class="kt-portlet__body pt-0">
            <!--begin: Datatable -->
            {{list}}
            <table class="table table-striped- table-hover table-checkable" id="kt_table_{{model.VARS.MODEL}}">
                <thead>
                    <tr>
                        {% for item in list %}
                            <th>{{item.title|upper}}</th>
                        {% endfor %}
                    </tr>
                </thead>
            </table>
            <!--end: Datatable -->
        </div>
    </div>
    <!-- end:: Content -->
{%endblock content%}

{%block js%}
	{{block.super}}
	<script src="{%static 'metronic/dist/demo5/assets/vendors/custom/datatables/datatables.bundle.js'%}" type="text/javascript"></script>
{%endblock js%}

<script>
{%block data%}
	{{ block.super }}
	selected_items: 0,
{%endblock data%}

{%block methods%}
	{{ block.super }}
	delete_row: function (row, alerts) {
		$.post(row.attr('value'), {
			'csrfmiddlewaretoken': '{{ csrf_token }}',
		}).done(function( json ){
			parent = row.parents('tr:first')
			parent.addClass('m-table__row--danger')
			parent.find('a').removeAttr( "href" )
			parent.find('.m-checkbox.m-checkbox--single').hide()
			parent.find('.m-btn--pill').hide()
			parent.find('.delete_row').hide()
			if(alerts){
				swal('Éxito!','Se eliminó correctamente el registro.','success');
			}
		}).fail(function(){
			if(alerts){
				swal('Error','Ocurrio un error al eliminar el registro.','error');
			}
		});
	},
{%endblock methods%}

{%block mounted%}
	{{block.super}}
	{%include 'generic/includes/list/datatable.js'%}
	$(document).on("click",".delete_row",function(event) {
		event.preventDefault();
		row = $(this)
		swal({
			title: row.attr('text'),
			text: "Los datos asociados, no se podrán recuperar.",
			type: 'warning',
			showCancelButton: true,
			confirmButtonText: 'Eliminar registro',
			cancelButtonText: 'Cancelar',
		}).then((result) => {
			if(result.value==true){
				self.delete_row(row, true)
			}
		})
	});
	$(document).on('click', '#m_form_delete_rows', function(event) {
		swal({
			title: "Estas seguro de eliminar estos registros?",
			text: "Los datos asociados, no se podrán recuperar.",
			type: 'warning',
			showCancelButton: true,
			confirmButtonText: 'Eliminar registro',
			cancelButtonText: 'Cancelar',
		}).then((result) => {
			if(result.value==true){
				Block();
				$.each( datatable{{model.VARS.MODEL}}.rows(".m-datatable__row--active").nodes().find('.m-checkbox--single>[type="checkbox"]'), function(key, row){
					self.delete_row($(row), false);
				});
				UnBlock();
			}
		});
	})
{%endblock mounted%}
</script>