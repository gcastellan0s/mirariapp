{% extends "index.html" %}
{% load i18n %}
{% load static %}
{% load mirari_tags %}

<style>
    {%block css%}
        .kt-portlet__head{
            background-color: white!important;
        }
        .kt-header__bottom{
            background-color: #20253e!important;
        }
        .kt-footer .kt-footer__bottom {
            background-color: #20253e!important;
        }
        @media (min-width: 1025px){
            .kt-header .kt-header__top {
                height: 75px;
            }
            .kt-header-menu .kt-menu__nav .kt-menu__item.kt-menu__item--active-tab .kt-menu__submenu, .kt-header-menu .kt-menu__nav .kt-menu__item.kt-menu__item--hover .kt-menu__submenu {
                width: 370px!important;
            }
            .kt-header-menu .kt-menu__nav > .kt-menu__item .kt-menu__inner > .kt-menu__item .kt-menu__link .kt-menu__link-text, .kt-header-menu .kt-menu__nav > .kt-menu__item .kt-menu__subnav > .kt-menu__item .kt-menu__link .kt-menu__link-text {
                display: -webkit-box;
                display: -ms-flexbox;
            }
        }
        .kt-body{
            min-height: 77.2vh;
        }
        .table td:focus {
            outline-width: 0px;
        }
    {%endblock css%}
</style>

{%block font%}
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
    <script>            
        WebFont.load({
                google: {"families":["Poppins:300,400,500,600,700"]},
                active: function() {
                    sessionStorage.fonts = true;                
                }            
        });        
    </script>
{%endblock font%}

{%block body_class%}
    kt-page--fluid kt-header--fixed kt-header--minimize-topbar kt-header-mobile--fixed kt-subheader--enabled kt-subheader--transparent kt-page--loading
{%endblock body_class%}

{%block body_content%}
        <!-- begin:: Page -->
        <!-- begin:: Header Mobile -->
        <div id="kt_header_mobile" class="kt-header-mobile  kt-header-mobile--fixed ">
            <div class="kt-header-mobile__brand">
                <a class="kt-header-mobile__logo" href="/">
                    <img alt="Logo" src="{{G.MEDIA}}{{ G.ORGANIZATION.LOGO }}" style="max-width: {{G.ORGANIZATION.DASHBOARD_LOGO_WIDTH|default:'65' }}px;"/>
                </a>
            </div>
            <div class="kt-header-mobile__toolbar">
                <span class="kt-header__topbar-icon kt-pulse kt-pulse--brand" id="kt_header_mobile_topbar_toggler">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" class="kt-svg-icon">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect id="bound" x="0" y="0" width="24" height="24"/>
                            <path d="M2.56066017,10.6819805 L4.68198052,8.56066017 C5.26776695,7.97487373 6.21751442,7.97487373 6.80330086,8.56066017 L8.9246212,10.6819805 C9.51040764,11.267767 9.51040764,12.2175144 8.9246212,12.8033009 L6.80330086,14.9246212 C6.21751442,15.5104076 5.26776695,15.5104076 4.68198052,14.9246212 L2.56066017,12.8033009 C1.97487373,12.2175144 1.97487373,11.267767 2.56066017,10.6819805 Z M14.5606602,10.6819805 L16.6819805,8.56066017 C17.267767,7.97487373 18.2175144,7.97487373 18.8033009,8.56066017 L20.9246212,10.6819805 C21.5104076,11.267767 21.5104076,12.2175144 20.9246212,12.8033009 L18.8033009,14.9246212 C18.2175144,15.5104076 17.267767,15.5104076 16.6819805,14.9246212 L14.5606602,12.8033009 C13.9748737,12.2175144 13.9748737,11.267767 14.5606602,10.6819805 Z" id="Combined-Shape" fill="#000000" opacity="0.3"/>
                            <path d="M8.56066017,16.6819805 L10.6819805,14.5606602 C11.267767,13.9748737 12.2175144,13.9748737 12.8033009,14.5606602 L14.9246212,16.6819805 C15.5104076,17.267767 15.5104076,18.2175144 14.9246212,18.8033009 L12.8033009,20.9246212 C12.2175144,21.5104076 11.267767,21.5104076 10.6819805,20.9246212 L8.56066017,18.8033009 C7.97487373,18.2175144 7.97487373,17.267767 8.56066017,16.6819805 Z M8.56066017,4.68198052 L10.6819805,2.56066017 C11.267767,1.97487373 12.2175144,1.97487373 12.8033009,2.56066017 L14.9246212,4.68198052 C15.5104076,5.26776695 15.5104076,6.21751442 14.9246212,6.80330086 L12.8033009,8.9246212 C12.2175144,9.51040764 11.267767,9.51040764 10.6819805,8.9246212 L8.56066017,6.80330086 C7.97487373,6.21751442 7.97487373,5.26776695 8.56066017,4.68198052 Z" id="Combined-Shape" fill="#000000"/>
                        </g>
                    </svg>                                
                </span>
            </div>
        </div>
        <!-- end:: Header Mobile -->
        <div class="kt-grid kt-grid--hor kt-grid--root">
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">
                <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper " id="kt_wrapper">
                    <!-- begin:: Header -->
                    <div id="kt_header" class="kt-header kt-grid__item  kt-header--fixed " data-ktheader-minimize="on">
                        <div class="kt-header__top">
                            <div class="kt-container">
                                <!-- begin:: Brand -->
                                    <div class="kt-header__brand   kt-grid__item" id="kt_header_brand">
                                        <div class="kt-header__brand-logo">
                                            <a href="/">
                                                <img alt="" src="{{G.MEDIA}}{{ G.ORGANIZATION.LOGO }}" style="max-width: {{G.ORGANIZATION.DASHBOARD_LOGO_WIDTH|default:'85' }}px;"/>
                                            </a>
                                        </div>
                                        <div class="kt-header__brand-nav">
                                            <div class="dropdown">
                                                <button type="button" class="btn btn-pill btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    {{request|get_session_organization}}
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-fit dropdown-menu-md">
                                                    <ul class="kt-nav kt-nav--bold kt-nav--md-space kt-margin-t-20 kt-margin-b-20">
                                                        {%for organization in request.user.my_organizations%}
                                                            <li class="kt-nav__item">
                                                                <a class="kt-nav__link active" href="#{{organization.pk}}" v-on:click.prevent="change_organization('{{organization.pk}}')">
                                                                    <span class="kt-nav__link-icon"><i class="flaticon-more"></i></span>
                                                                    <span class="kt-nav__link-text">{{ organization }}</span>
                                                                </a>
                                                            </li>
                                                        {%endfor%}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <!-- end:: Brand -->
                                <!-- begin:: Header Topbar -->
                                <div class="kt-header__topbar">
                                    <!--begin: User bar -->
                                    <div class="kt-header__topbar-item kt-header__topbar-item--user">
                                        <div class="kt-header__topbar-wrapper" data-toggle="dropdown" data-offset="10px,10px">
                                            <span class="kt-header__topbar-welcome">{%trans 'Hola'%},&nbsp;</span>
                                            <span class="kt-header__topbar-username text-primary">{{request.user.visible_username}}</span>
                                            <span class="kt-badge kt-badge--username kt-badge--unified-success kt-badge--lg kt-badge--rounded kt-badge--bold">{{request.user.visible_username.0|upper}}</span>
                                        </div>
                                        <div class="dropdown-menu dropdown-menu-fit dropdown-menu-right dropdown-menu-anim dropdown-menu-xl">
                                            <!--begin: Head -->
                                            <div class="kt-user-card kt-user-card--skin-light kt-notification-item-padding-x">
                                                <div class="kt-user-card__avatar">
                                                    <!--use below badge element instead the user avatar to display username's first letter(remove kt-hidden class to display it) -->
                                                    <span class="kt-badge kt-badge--username kt-badge--unified-success kt-badge--lg kt-badge--rounded kt-badge--bold kt-hidden">S</span>
                                                </div>
                                                <div class="kt-user-card__name">
                                                    {{request.user.email}}
                                                </div>
                                            </div>
                                            <!--end: Head -->
                                            <!--begin: Navigation -->
                                            <div class="kt-notification">
                                                {%if request.user.can_change_password%}
                                                    <a href="{{request.user.url_password}}" class="kt-notification__item">
                                                        <div class="kt-notification__item-icon">
                                                            <i class="kt-nav__link-icon la la-key"></i>
                                                        </div>
                                                        <div class="kt-notification__item-details">
                                                            <div class="kt-notification__item-title kt-font-bold">
                                                                {%trans 'CAMBIAR MI CONTRASEÑA'%}
                                                            </div>
                                                            <div class="kt-notification__item-time">
                                                                {%trans 'Cambia tu contraseña asignada'%}
                                                            </div>
                                                        </div>
                                                    </a>
                                                {%endif%}
                                                <div class="kt-notification__custom">
                                                    <a href="{%url 'mirari:logout__Organization__TemplateView'%}" class="btn btn-label-danger btn-sm btn-bold">
                                                        {%trans 'SALIR'%}
                                                    </a>
                                                </div>
                                            </div>
                                            <!--end: Navigation -->
                                        </div>
                                    </div>
                                    <!--end: User bar -->
                                </div>
                                <!-- end:: Header Topbar -->
                            </div>
                        </div>
                        <div class="kt-header__bottom">
                            <div class="kt-container">
                                <!-- begin: Header Menu -->
                                <button class="kt-header-menu-wrapper-close" id="kt_header_menu_mobile_close_btn"><i class="la la-close"></i></button>
                                <div class="kt-header-menu-wrapper" id="kt_header_menu_wrapper">
                                    <div id="kt_header_menu" class="kt-header-menu kt-header-menu-mobile ">
                                        <ul class="kt-menu__nav ">
                                            {% block menu_header %}
                                                {%for key, modules in 'mirari'|get_menu%}
                                                    <li class="kt-menu__item  kt-menu__item--submenu kt-menu__item--rel" data-ktmenu-submenu-toggle="click" aria-haspopup="true" v-if="MENU__{{key}}.length > 0">
                                                        <a href="javascript:;" class="kt-menu__link kt-menu__toggle">
                                                            <span class="kt-menu__link-text">{{modules.title}}</span>
                                                        </a>
                                                        <div class="kt-menu__submenu  kt-menu__submenu--fixed kt-menu__submenu--left">
                                                            <div class="kt-menu__subnav">
                                                                <ul class="kt-menu__content">
                                                                    <li class="kt-menu__item ">
                                                                        <h3 class="kt-menu__heading kt-menu__toggle">
                                                                            <i class="kt-menu__link-bullet kt-menu__link-bullet--dot"><span></span></i>
                                                                            <span class="kt-menu__link-text">{{modules.title}}</span>
                                                                            <i class="kt-menu__ver-arrow la la-angle-right"></i>
                                                                        </h3>
                                                                        <ul class="kt-menu__inner">
                                                                            {%for module in modules.modules%}
                                                                                {%if request|has_app:module.apps and request|has_permission:module%}
                                                                                    <li class="kt-menu__item " aria-haspopup="true">
                                                                                        <a href="{{module|get_url}}" class="kt-menu__link ">
                                                                                            <i class="kt-menu__link-icon {{module.icon}}"></i>
                                                                                            <span class="kt-menu__link-text">
                                                                                                {{module.title|upper}}
                                                                                                <br />
                                                                                                <small class="text-muted">{{module.text}}</small>
                                                                                            </span>
                                                                                        </a>
                                                                                    </li>
                                                                                {%endif%}
                                                                            {%endfor%}
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                {%endfor%}
                                            {% endblock menu_header %}
                                        </ul>
                                    </div>
                                </div>
                                <!-- end: Header Menu -->
                            </div>
                        </div>
                    </div>
                    <!-- end:: Header -->
                    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-grid--stretch">
                        <div class="kt-container kt-body  kt-grid kt-grid--ver" id="kt_body">
                            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
                                <!-- begin:: Subheader -->
                                <div class="kt-subheader kt-grid__item" id="kt_subheader">
                                    {%block subheader%}
                                    {%endblock subheader%}
                                </div>
                                <!-- end:: Subheader -->
                                <!-- begin:: Content -->
                                <div class="kt-content kt-grid__item kt-grid__item--fluid">
                                    <!--Begin::Dashboard 5-->
                                    {%block content%}{%endblock content%}
                                    <!--End::Dashboard 5-->
                                </div>
                                <!-- end:: Content -->
                            </div>
                        </div>
                    </div>
                    <!-- begin:: Footer -->
                    <div class="kt-footer  kt-footer--extended  kt-grid__item" id="kt_footer">
                        <div class="kt-footer__bottom">
                            <div class="kt-container">
                                <div class="kt-footer__wrapper">
                                    <div class="kt-footer__copyright text-light">
                                        {% now "Y" %} {{ G.ORGANIZATION.TITLE }} :: {{ G.ORGANIZATION.SLOGAN }} <a href="/" target="_blank" class="text-secondary">- MIRARI.XYZ</a>
                                    </div>
                                    <div class="kt-footer__menu">
                                        <a href="" target="_blank">NOSOTROS</a>
                                        <a href="" target="_blank">PRIVACIDAD</a>
                                        <a href="" target="_blank">PREGUNTAS</a>
                                        <a href="" target="_blank">SOPORTE</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end:: Footer -->
                </div>
            </div>
        </div>
        <!-- end:: Page -->
        <!-- begin::Scrolltop -->
            <div id="kt_scrolltop" class="kt-scrolltop">
                <i class="fa fa-arrow-up"></i>
            </div>
        <!-- end::Scrolltop -->
{%endblock body_content%}

{%block js%} 
    <script>            
        var KTAppOptions = {
            "colors":{
                "state":{
                    "brand":"#3d94fb",
                    "light":"#ffffff",
                    "dark":"#282a3c",
                    "primary":"#5867dd",
                    "success":"#34bfa3",
                    "info":"#3d94fb",
                    "warning":"#ffb822",
                    "danger":"#fd2763" //#fd27eb
                },
                "base":{
                    "label":["#c5cbe3","#a1a8c3","#3d4465","#3e4466"],
                    "shape":["#f0f3ff","#d9dffa","#afb4d4","#646c9a"]
                }
            }
        };
    </script>
{%endblock js%}

<script>
{%block data%} 
    {%for key, modules in 'mirari'|get_menu%}
        MENU__{{key}}:[
            {%for module in modules.modules%}
                {%if request|has_app:module.apps and request|has_permission:module%}
                    '{{module.title|upper}}',
                {%endif%}
            {%endfor%}
        ],
    {%endfor%}
{%endblock data%}

{%block methods%}
    change_organization(pk) {
        Block();
        Ax('post', '{%url 'mirari:ChangeOrganization__ApiView' 'mirari' 'Organization'%}?pk='+pk).then(function(json){
            if (!json.data.message) location.reload();
            else {
                swal('Error!', json.data.message, 'error') 
                UnBlock();
            }
        })
    },
    back_history() {
        window.history.back();
    },
{%endblock methods%}

{%block global_functions%}
    {%include 'generic/includes/global_functions.html'%}
{%endblock global_functions%}

{%block scripts%}
{%endblock scripts%}
</script>