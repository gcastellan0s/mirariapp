{% extends "generic/ListView.html" %} 
{% load static %}
{% load i18n %}
{% load mirari_tags %}

{%block extra_header_menu%}
{%endblock extra_header_menu%}

{%block extra_buttonsList%}
    <form method="get" class="kt-quick-search__form mb-4" v-on:submit.prevent="ProductSubmit" id="FormSubmit">
        <div class="input-group">
            <a href="#" class="btn btn-brand btn-elevate btn-icon-sm mr-4" onclick="var message={action:'GetQR', target:'codebar'}; webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify(message));">
                ESCANEAR CB
            </a>
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <i class="fas fa-barcode"></i>
                </span>
            </div>
            <input type="text" class="form-control kt-quick-search__input" placeholder="CB DEL PRODUCTO" autofocus="autofocus" id="id_codebar" v-model="codebar">
        </div>
    </form>
    
{%endblock extra_buttonsList%}

<script>
{%block data%}
    {{ block.super }}
    codebar:'',
{%endblock data%}

{%block methods%}
    {{ block.super }}
    ProductSubmit() {
        Block();
        setTimeout( function(){
            Ax('post', '/STR/api/InventoryApi/STR/Product/', {'codebar':self.codebar})
            .then(function(json){
                console.log(json)
                Swal.fire({
                    title: `${json.data.product}`,
                    html:
                        `<div class="kt-widget kt-widget--user-profile-4">
                            <div class="kt-widget__body">
                                <a href="#" class="kt-widget__item kt-widget__item--active">
                                    VER PRODUCTO              
                                </a>
                                <a href="#" class="kt-widget__item">
                                    AGREGAR AL INVENTARIO          
                                </a>
                            </div>
                        </div>`,
                    focusConfirm: false,
                })
            })
            .catch((error) => {
                console.log(error)
                swal('Error!', 'Revisa el nÃºmero de tu consulta', 'error')
            }).finally(() => {
                UnBlock();
            });
        }, 500);
    },
{%endblock methods%}
</script>