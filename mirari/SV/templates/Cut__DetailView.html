{% extends "generic/DetailView.html" %}
{% load static %}
{% load i18n %}
{% load mirari_tags %}

{%block object_name%}{{object.sellpoint.name}}| CORTE {{object.serial}} {%endblock object_name%}

{%block content%}
	<!-- begin:: Content -->
	<div class="m-content  m-grid__item m-grid__item--fluid" id="kt_content">
		<div class="row">
			<div class="col-lg-12">
				<div class="m-portlet">
					<div class="m-portlet__body m-portlet__body--fit">
						<div class="m-invoice-2">
							<div class="m-invoice__wrapper">
								<div class="kt-invoice__head mb-5">
									<div class="row">
										<div class="col-lg-6">
											<div class="kt-invoice__container kt-invoice__container--centered">
												<div class="kt-invoice__logo m--align-right">
													<h1>CORTE {{object.serial}}</h1>
												</div>
												<div class="kt-invoice__items m--align-right">
													<div class="kt-invoice__item m--align-right">
														<span class="kt-invoice__subtitle">FECHA DE CORTE</span>
														<span class="kt-invoice__text"><strong>{{object.final_time|default:'Venta en curso'}}</strong></span>
													</div>
													<div class="kt-invoice__item m--align-right">
														<span class="kt-invoice__subtitle">PRIMER TICKET</span>
														<span class="kt-invoice__text"><strong>{{object.initial_time}}</strong></span>
													</div>
													<div class="kt-invoice__item m--align-right" v-if="CutDetail">
														<span class="kt-invoice__subtitle">TOTAL TICKETS</span>
														<span class="kt-invoice__text"><strong>{{object.getLenTickets}}</strong> clientes / <strong>${CutDetail.TotalDetail['all'][1]}</strong> </span>
													</div>
													<div class="kt-invoice__item m--align-right" v-if="CutDetail">
														<span class="kt-invoice__subtitle">TOTAL FALTANTES</span>
														<span class="kt-invoice__text"><strong>{{object.getLenFaltante}}</strong> clientes / <strong>${CutDetail.TotalDetail['all'][3]}</strong> </span>
													</div>
												</div>
											</div>
										</div>
										<div class="col-lg-6">
											<div class="kt-invoice__container kt-invoice__container--centered">
												<div class="kt-invoice__logo">
													<h1>{{object.sellpoint.name}}</h1>
												</div>
												<span class="kt-invoice__desc">
													{%if object.sellpoint.header_line_black_1%}<span>{{object.sellpoint.header_line_black_1}} </span></br>{%endif%}
													{%if object.sellpoint.header_line_black_2%}<span>{{object.sellpoint.header_line_black_2}} </span></br>{%endif%}
													{%if object.sellpoint.header_line_1%}<span>{{object.sellpoint.header_line_1}} </span></br>{%endif%} 
													{%if object.sellpoint.header_line_2%}<span>{{object.sellpoint.header_line_2}} </span></br>{%endif%}
												</span>
											</div>
										</div>
									</div>
								</div>
								<div class="m-invoice__body m-invoice__body--centered pt-0" v-if="CutDetail">
									<div class="table-responsive" v-for="cuttypes in CutTypes">
                                        <h5 v-if="cuttypes=='all'">TOTAL</h5>
                                        <h5 v-else>${cuttypes}</h5>
										<table class="table">
											<thead>
												<tr>
													<th>PRODUCTO</th>
													<th>PRECIO</th>
													<th>CANTIDAD</th>
													<th>IVA</th>
													<th>IEPS</th>
													<th>TOTAL</th>
												</tr>
											</thead>
											<tbody>
                                                <template v-for="product in CutDetail.ProductsDetail[cuttypes]">
                                                    <tr>
                                                        <td>${product.productName}</td>
                                                        <td>${product.getPrice}</td>
                                                        <td>${product.quantity}</td>
                                                        <td>${product.getIvaMoney}</td>
                                                        <td>${product.getIepsMoney}</td>
                                                        <td><strong>${product.getTotalMoney}</strong></td>
                                                    </tr>
                                                    <tr v-for="offer in product.offers">
                                                        <td colspan="4" style="padding: 0"></td>
                                                        <td style="padding: 0"><small>${offer.quantity}</small></td>
                                                        <td style="padding: 0"><small>${offer.offerName}</small></td>
                                                    </tr>
                                                    <tr v-if="Object.keys(product.offers).length>0">
                                                        <td colspan="5" style="padding: 0"></td>
                                                        <td style="padding: 0"><small>$ ${product.offersTotal|formatPrice}</small></td>
                                                    </tr>
                                                </template>
                                                <tr>
                                                    <td colspan="4"></td>
                                                    <td>FALTANTE</td>
                                                    <td><strong>${CutDetail.TotalDetail[cuttypes][3]}</strong></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4"></td>
                                                    <td>TOTAL</td>
                                                    <td><strong>${CutDetail.TotalDetail[cuttypes][1]}</strong></td>
                                                </tr>
											</tbody>
										</table>
									</div>
								</div>
                                {%comment%}
                                    <div class="m-invoice__body m-invoice__body--centered p-0">
                                        <div class="m-portlet__body">
                                            <div id="m_flotcharts_2" style="height: 300px;"></div>
                                            
                                        </div>
                                    </div>
                                {%endcomment%}
								<div class="m-invoice__footer mt-1">
									<div class="m-invoice__table  m-invoice__table--centered table-responsive">
										<table class="table">
											<thead>
												<tr>
													<th class="m--align-right"></th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td class="m-font-danger m--align-right"><small>SUBTOTAL</small> <strong class="ml-2">{{object.getSubtotalMoney}}</strong></td>
												</tr>
												<tr>
													<td class="m-font-danger m--align-right"><small>IEPS</small> <strong class="ml-2">{{object.getIepsMoney}}</strong></td>
												</tr>
												<tr>
													<td class="m-font-danger m--align-right"><small>IVA</small> <strong class="ml-2">{{object.getIvaMoney}}</strong></td>
												</tr>
                                                <tr>
													<td class="m-font-danger m--align-right"><small>FALTANTE</small> <strong class="ml-2">{{object.getFaltanteMoney}}</strong></td>
												</tr>
												<tr>
													<td class="m-font-danger m--align-right">GRAN TOTAL <strong class="ml-2">{{object.getTotalMoney}}</strong></td>
												</tr>
                                                <tr>
													<td class="m-font-danger m--align-right"><small>+ FALTANTE</small> <strong class="ml-2">{{object.getTotalFaltanteMoney}}</strong></td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end:: Content -->
{%endblock content%}

{%block js%}
    <script src="{%static 'metronic/dist/demo5/assets/vendors/custom/flot/flot.bundle.js'%}" type="text/javascript"></script>
{%endblock js%}

<script>
{%block data%}
    CutTypes: [{%for ticketTypes in object.ticketTypes.all%}'{{ticketTypes}}',{%endfor%}],
    CutDetail: null,
{%endblock data%}

{%block mounted%}
    Block(text="Calculando corte...");
    Ax('post', '{%url 'SV:Sellpoint__ApiView' 'SV' 'set_sellpoint' 'Sellpoint'%}?api=getCut',{'cut':{{object.pk}}},errorDialog=false).then(function(json){
        console.log(json)
        self.CutDetail = json.data.cut
    }).catch((error) => {
        console.log(error)
        swal('Ooops!','{% trans "No hay conexiÃ³n con el servidor, intente de nuevo mas tarde."%}','error')
    }).finally(() => {
        UnBlock();
    });
    function t() {
        return Math.floor(21 * Math.random()) + 20
    }
    var e = [
        [1, t()],
        [2, t()],
        [3, 2 + t()],
        [4, 3 + t()],
        [5, 5 + t()],
        [6, 10 + t()],
        [7, 15 + t()],
        [8, 20 + t()],
        [9, 25 + t()],
        [10, 30 + t()],
        [11, 35 + t()],
        [12, 25 + t()],
        [13, 15 + t()],
        [14, 20 + t()],
        [15, 45 + t()],
        [16, 50 + t()],
        [17, 65 + t()],
        [18, 70 + t()],
        [19, 85 + t()],
        [20, 80 + t()],
        [21, 75 + t()],
        [22, 80 + t()],
        [23, 75 + t()],
        [24, 70 + t()],
        [25, 65 + t()],
        [26, 75 + t()],
        [27, 80 + t()],
        [28, 85 + t()],
        [29, 90 + t()],
        [30, 95 + t()]
    ],
    o = [
        [1, t() - 5],
        [2, t() - 5],
        [3, t() - 5],
        [4, 6 + t()],
        [5, 5 + t()],
        [6, 20 + t()],
        [7, 25 + t()],
        [8, 36 + t()],
        [9, 26 + t()],
        [10, 38 + t()],
        [11, 39 + t()],
        [12, 50 + t()],
        [13, 51 + t()],
        [14, 12 + t()],
        [15, 13 + t()],
        [16, 14 + t()],
        [17, 15 + t()],
        [18, 15 + t()],
        [19, 16 + t()],
        [20, 17 + t()],
        [21, 18 + t()],
        [22, 19 + t()],
        [23, 20 + t()],
        [24, 21 + t()],
        [25, 14 + t()],
        [26, 24 + t()],
        [27, 25 + t()],
        [28, 26 + t()],
        [29, 27 + t()],
        [30, 31 + t()]
    ];
    $.plot($("#m_flotcharts_2"), [{
        data: e,
        label: "Unique Visits",
        lines: {
            lineWidth: 1
        },
        shadowSize: 0
    }, {
        data: o,
        label: "Page Views",
        lines: {
            lineWidth: 1
        },
        shadowSize: 0
    }], {
        series: {
            lines: {
                show: !0,
                lineWidth: 2,
                fill: !0,
                fillColor: {
                    colors: [{
                        opacity: .05
                    }, {
                        opacity: .01
                    }]
                }
            },
            points: {
                show: !0,
                radius: 3,
                lineWidth: 1
            },
            shadowSize: 2
        },
        grid: {
            hoverable: !0,
            clickable: !0,
            tickColor: "#eee",
            borderColor: "#eee",
            borderWidth: 1
        },
        colors: ["#d12610", "#37b7f3", "#52e136"],
        xaxis: {
            ticks: 11,
            tickDecimals: 0,
            tickColor: "#eee"
        },
        yaxis: {
            ticks: 11,
            tickDecimals: 0,
            tickColor: "#eee"
        }
    });
{%endblock mounted%}

{%block filters%}
    formatPrice: ((value) => {
        let val = (value/1).toFixed(2)
        return val.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")
    }),
    {%endblock filters%}
</script>