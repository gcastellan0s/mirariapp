extends "generic/DetailView.html"
-load static
-load i18n
-load mirari_tags

block object_name
    {{object.sellpoint.name}}

block styles
    {{block.super}}
    link(href="{%static 'metronic/dist/demo5/assets/app/custom/invoices/invoice-v2.default.css'%}", rel='stylesheet', type='text/css')
    style.
        .kt-invoice-2 .kt-invoice__actions .kt-invoice__container {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }
    .

block content
    .kt-portlet
        .kt-portlet__body.kt-portlet__body--fit
            .kt-invoice-2
                .kt-invoice__wrapper
                    .kt-invoice__actions.px-5.pt-4
                        .kt-invoice__container
                            button.btn.btn-brand.btn-bold(type='button', onclick='window.print();') IMPRIMIR
                    .kt-invoice__head.kt-invoice__container.kt-invoice__container--centered
                        .row
                            .col-lg-12
                                form.kt-form.kt-form--label-right
                                    .kt-portlet__body
                                        .form-group
                                            label(for='') ELIGE UN MES
                                            select#exampleSelect1.form-control
                                                option(selected='') ---
                                                option(value='3/2019') Marzo 2019
                                                option(value='4/2019') Abril 2019
                                                option(value='5/2019') Mayo 2019
                                                option(value='6/2019') Junio 2019
                                                option(value='7/2019') Julio 2019
                                                option(value='8/2019') Agosto 2019
                                                option(value='9/2019') Septiembre 2019
                    .kt-invoice__body.kt-invoice__body--centered
                        .table-responsive
                            table.table
                                thead
                                    tr
                                        th DIA
                                        th PRODUCTOS 0%
                                        th PRODUCTOS .08%
                                        th PRODUCTOS .16%
                                        th SUBTOTAL
                                        th TOTAL
                                tbody
                                    tr(v-for="cut in Cuts")
                                        td ${cut.day}
                                        td ${cut.day}
                                        td ${cut.day}
                                        td ${cut.day}
                                        td ${cut.day}
                                        td ${cut.day}

script.
    {%block data%}
        {{block.super}}
        Cuts: [],
    {%endblock data%}

    {%block mounted%}
        {{block.super}}
        self.getCut()
    {%endblock mounted%}

    {%block methods%}
        {{block.super}}
        getCut:(() => {
            Block(text="Calculando tabla...");
            for (day = 1; day <= 31; day++) {
                Ax('post', '{%url 'SV:Sellpoint__ApiView' 'SV' 'set_sellpoint' 'Sellpoint'%}?api=getReport',{'sellpointgroup':{{object.pk}},'month':5,'day':day}, errorDialog=false)
                .then((json) => {
                    if (json.data.cuts){
                        self.Cuts.push({'day':json.data.day, 'cuts':json.data.cuts})
                        self.Cuts.sort(function (a, b) {
                            if (a.day < b.day) {
                                return 1;
                            }
                            if (a.day > b.day) {
                                return -1;
                            }
                            return 0;
                        });
                    }
                }).catch((error) => {
                    Swal.fire('Ooops!',error.response.data.message,'error')
                })
            }
            UnBlock();
        }),
    {%endblock methods%}

    {%block filters%}
        {{block.super}}
    {%endblock filters%}
.